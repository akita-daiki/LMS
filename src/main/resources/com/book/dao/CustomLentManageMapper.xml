<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.book.dao.CustomLentManageMapper">
	<resultMap id="BaseResultMap"
		type="com.book.entity.LentManage">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Dec 14 
			11:49:28 JST 2023. -->
		<id column="LENT_ID" jdbcType="INTEGER" property="lentId" />
		<result column="BOOK_ID" jdbcType="INTEGER" property="bookId" />
		<result column="USER_ID" jdbcType="INTEGER" property="userId" />
		<result column="LENTDATE" jdbcType="TIMESTAMP"
			property="lentdate" />
		<result column="EXPECTED_RETURNDATE" jdbcType="TIMESTAMP"
			property="expectedReturndate" />
		<result column="RETURNDATE" jdbcType="TIMESTAMP"
			property="returndate" />
		<result column="LENTFLAG" jdbcType="INTEGER"
			property="lentflag" />
		<result column="CREATE_DATE" jdbcType="TIMESTAMP"
			property="createDate" />
		<result column="UPDATE_DATE" jdbcType="TIMESTAMP"
			property="updateDate" />
		<result column="DELETE_FLAG" jdbcType="INTEGER"
			property="deleteFlag" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Dec 14 
			11:49:28 JST 2023. -->
		LENT_ID, BOOK_ID, USER_ID, LENTDATE, EXPECTED_RETURNDATE, RETURNDATE,
		LENTFLAG, CREATE_DATE,
		UPDATE_DATE, DELETE_FLAG
	</sql>
	<!-- 連番採取 -->
	<select id="getLastLentId" resultType="java.lang.Integer">
		SELECT LENT_ID FROM
		lent_manage ORDER BY LENT_ID DESC LIMIT 1
	</select>
	<!-- BOOKIDで更新 -->
	<update id="updateByBookId"
		parameterType="com.book.entity.LentManage">
		update lent_manage
		<set>
			<if test="userId != null">
				USER_ID = #{userId,jdbcType=INTEGER},
			</if>
			<if test="lentdate != null">
				LENTDATE = #{lentdate,jdbcType=TIMESTAMP},
			</if>
			<if test="expectedReturndate != null">
				EXPECTED_RETURNDATE =
				#{expectedReturndate,jdbcType=TIMESTAMP},
			</if>
			<if test="returndate != null">
				RETURNDATE = #{returndate,jdbcType=TIMESTAMP},
			</if>
			<if test="lentflag != null">
				LENTFLAG = #{lentflag,jdbcType=INTEGER},
			</if>
			<if test="createDate != null">
				CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
			</if>
			<if test="updateDate != null">
				UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="deleteFlag != null">
				DELETE_FLAG = #{deleteFlag,jdbcType=INTEGER},
			</if>
		</set>
		where BOOK_ID = #{bookId,jdbcType=INTEGER}
		and LENTFLAG = 1
	</update>
	<!-- レンタル中図書検索 -->
	<select id="searchByUserIdAndFlags"
		resultType="com.book.entity.LentManage">
		SELECT * FROM lent_manage
		WHERE USER_ID = #{userId,jdbcType=INTEGER}
		AND LENTFLAG = 1
		AND DELETE_FLAG = 0
	</select>
	<!-- 全件検索 -->
	<select id="findAll" resultType="com.book.entity.LentManage">
		SELECT * FROM lent_manage WHERE delete_flag = 0
	</select>

</mapper>
